# Maintainer: WinterMute <davem@devkitpro.org>
_libname=libjpeg-turbo
pkgname=3ds-${_libname}
pkgver=3.1.2
pkgrel=1
pkgdesc='libjpeg derivative with accelerated baseline JPEG compression and decompression'
arch=('any')
url='https://github.com/libjpeg-turbo/libjpeg-turbo'
license=('IJG')
options=(!strip libtool staticlibs)
source=(
  "${_libname}-${pkgver}.tar.gz::${url}/archive/refs/tags/${pkgver}.tar.gz"
)
sha256sums=('560f6338b547544c4f9721b18d8b87685d433ec78b3c644c70d77adad22c55e6')
makedepends=('3ds-cmake' '3ds-pkg-config' 'dkp-toolchain-vars')
groups=('3ds-portlibs')

build() {
  cd libjpeg-turbo-$pkgver

  source /opt/devkitpro/3dsvars.sh

  arm-none-eabi-cmake -DENABLE_SHARED:BOOLEAN=false -DCMAKE_INSTALL_PREFIX=$PORTLIBS_PREFIX .

  make
}

package() {
  cd libjpeg-turbo-$pkgver

  source /opt/devkitpro/3dsvars.sh

  make DESTDIR="$pkgdir" install
  # license
  install -d "$pkgdir"${PORTLIBS_PREFIX}/licenses/$pkgname
  cp -v LICENSE.md "$pkgdir"${PORTLIBS_PREFIX}/licenses/$pkgname/
  # remove useless stuff
  rm -r "$pkgdir"${PORTLIBS_PREFIX}/share
  rm -r "$pkgdir"${PORTLIBS_PREFIX}/bin

}
